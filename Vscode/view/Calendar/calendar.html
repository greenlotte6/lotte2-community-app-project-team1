<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <link rel="stylesheet" href="/css/main/dashboard/dashboardMain.css" />

    <script src="/scripts/dashboardMain.js"></script>

    <style>

      body {
      overflow-x: hidden;
    }
      #calendar-container {
      width: 100%;
      max-width: 1000px;
      margin: 10px auto;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow-x: hidden;
    }

    .calendar-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: bold;
    }

    .calendar-header button {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }

    .calendar-table {
      width: 100%;
      border-collapse: collapse;
    }

    .calendar-table th,
    .calendar-table td {
      width: 14.28%;
      height: 90px;
      border: 1px solid #ddd;
      vertical-align: top;
    }

    .calendar-table th {
      background: #0A468C;
      color: white;
      height: 40px;
      padding-top: 20px;
    }

    .calendar-table td {
      cursor: pointer;
      position: relative;
    }

    .calendar-table td:hover {
      background-color: #f0f0f0;
    }

    .event {
      background-color: #f6b3dc;
      padding: 4px;
      margin-top: 5px;
      font-size: 12px;
    }

    .modal {
      position: absolute;
      z-index: 1000;
      display: none;
      background: white;
      border-radius: 10px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
      padding: 20px;
      text-align: center;
      transition: opacity 0.2s ease;
      opacity: 0.7;
    }
        /* ğŸ”¸ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ì— ëœ¨ëŠ” ê°„í¸ ëª¨ë‹¬ */
    .simple-modal {
      position: absolute;
      width: 200px;
    }

    /* ğŸ”¸ í™”ë©´ ì¤‘ì•™ì— ëœ¨ëŠ” ì„¸ë¶€ ëª¨ë‹¬ */
    .detail-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      min-width: 300px;
      max-width: 90%;
    }

    .modal-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
    }

    .import-note {
      margin-top: 30px;
      font-size: 13px;
      color: #666;
      text-align: center;
    }
    .dim {
    color: #dbd6d6;
    }

    .calen{
      border-radius: 20px;
      width: 250px;
      height: 30px;
      margin: 0 auto;
      background-color: #a1c4fd;
    }

    .calen:hover{
      border-radius: 20px;
      width: 250px;
      height: 30px;
      margin: 0 auto;
      background-color: #0b5ee2;
      color: #f0f0f0;
    }

    .event-range {
      background-color: #a1c4fd;
      color: #fff;
      padding: 4px 6px;
      border-radius: 6px;
      text-align: center;
      font-size: 12px;
      height: 20px;
      white-space: nowrap;
    }

    #detail-schedule-modal textarea {
      resize: vertical;
      padding: 6px;
      border-radius: 6px;
      font-family: inherit;
    }
    #detail-schedule-modal label {
      text-align: left;
      font-size: 14px;
      margin-top: 6px;
    }
 
.flatpickr-calendar {
  /* width: 100% !important; */
  max-width: 18% !important;
}
#view-schedule-modal {
  position: absolute;
  top: 50%;
  left: 60%;
  transform: translate(-50%, -50%); /* ì¤‘ì•™ ì •ë ¬ */
  z-index: 9999; /* ìº˜ë¦°ë”ë³´ë‹¤ ìœ„ì— ì¶œë ¥ */
  background-color: white;
  border: 1px solid #ccc;
  padding: 20px;
  width: 300px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  display: none;
  border-radius: 8px;
}

    
    </style>
  </head>
  <body>
    <div class="wrapper">
      <div class="wrapperside">
        <div class="profileArea">
          <img src="/images/user.png" alt="profile" />
        </div>
        <ul>
          <li>
            <a href="#"><img src="/images/Grid.svg" alt="dashboard" /></a>
          </li>
          <li>
            <a href="#"><img src="/images/File text.svg" alt="document" /></a>
          </li>
          <li>
            <a href="#"><img src="/images/Calendar.svg" alt="calendar" /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/Message square.svg" alt="message"
            /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/Clipboard.svg" alt="message-board"
            /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/gmail_groups.svg" alt="director"
            /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/Cloud.svg" alt="cloud-computing"
            /></a>
          </li>
          <li>
            <a href="#"><img src="/images/Settings.svg" alt="setting" /></a>
          </li>
        </ul>
      </div>
      <div class="container">
        <header>
          <div class="headerArea">
            <div class="headerlogo">
              <a href="#"><img src="/images/logo.png" alt="J2SMLogo" /></a>
            </div>
            <div class="darkmode">
              <label class="toggle-switch">
                <span class="label-text">DARK MODE</span>
                <input type="checkbox" id="darkModeToggle" />
                <span class="slider"></span>
              </label>
            </div>
            <div class="alert">
              <img src="/images/bell.png" alt="bell" />
            </div>
          </div>
        </header>
        <main>
          <aside>
            <div class="sidemenu">
              <div class="sideTop">
                <h3>Calendar</h3>
              </div>
              <a href="#">ë‚´ ìº˜ë¦°ë”</a>
              <a href="#">ê³µìœ  ìº˜ë¦°ë”</a>
            </div>
          </aside>
          <div class="contentArea">
             <div id="calendar-container">
                <div class="calendar-header">
                  <button onclick="prevMonth()">â®</button>
                  <span id="calendar-title" style="margin: 0 40px;"></span>
                  <button onclick="nextMonth()">â¯</button>
                </div>

                <table class="calendar-table">
                  <thead>
                    <tr>
                      <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                    </tr>
                  </thead>
                  <tbody id="calendar-body"></tbody>
                </table>

                
              </div>

              <!-- ì¼ì • ëª¨ë‹¬ -->
              <div id="schedule-modal" class="modal">
                <div class="modal-content" onclick="event.stopPropagation()">
                  <span class="close" onclick="closeModal()">&times;</span>
                  <h3>ê°„í¸ ì¼ì • ë“±ë¡</h3>
                  <input type="hidden" id="modal-date" />
                  <input type="text" id="modal-title" placeholder="ì¼ì • ì œëª© ì…ë ¥" />
                  <button class="calen" onclick="saveSchedule()">ë“±ë¡í•˜ê¸°</button>
                  <button class="calen" onclick="openDetailModal()">ì„¸ë¶€ì¼ì •ë“±ë¡</button>
                  <button class="calen" onclick="">ì•ŒëŒ ON</button>
                  <button class="calen" onclick="">ì¼ì • ì‚­ì œ</button>
                </div>
              </div>
          </div>
        </main>
        <footer></footer>
      </div>
    </div>
  </body>

    <div id="detail-schedule-modal" class="modal detail-modal">
  <div class="modal-content" onclick="event.stopPropagation()">
    <span class="close" onclick="closeDetailModal()">&times;</span>
    <h3>ì„¸ë¶€ì¼ì • ë“±ë¡</h3>

    <label>ì¼ì • ì œëª©</label>
    <input type="text" id="detail-title" class="form-input" placeholder="ì¼ì • ì œëª©" />

    <label>ì‹œì‘ ë‚ ì§œ</label>
    <input type="date" id="start-date" class="form-input" />

    <label>ì¢…ë£Œ ë‚ ì§œ</label>
    <input type="date" id="end-date" class="form-input" />

    <label>ë¹„ê³ </label>
    <textarea id="detail-note" rows="3" placeholder="ì¶”ê°€ ë©”ëª¨..."></textarea>

    <button class="calen" onclick="submitDetailSchedule()">ë“±ë¡</button>
  </div>
</div>

<div id="view-schedule-modal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" onclick="closeViewModal()">&times;</span>
    <h3>ì¼ì • ìƒì„¸ ë³´ê¸°</h3>
    <p><strong>ë‚ ì§œ:</strong> <span id="view-date"></span></p>
    <p><strong>ì œëª©:</strong> <span id="view-title"></span></p>
    <p><strong>ë©”ëª¨:</strong> <span id="view-note"></span></p>
  </div>
</div>

  <script>
let currentYear = new Date().getFullYear();
let currentMonth = new Date().getMonth() + 1;
let schedules = [];

function renderCalendar(year, month) {
  const calendarBody = document.getElementById("calendar-body");
  const title = document.getElementById("calendar-title");
  title.innerText = `${year}.${String(month).padStart(2, '0')}`;
  calendarBody.innerHTML = "";

  const firstDay = new Date(year, month - 1, 1).getDay();
  const lastDate = new Date(year, month, 0).getDate();
  const prevLastDate = new Date(year, month - 1, 0).getDate();

  let nextMonthDate = 1;

  for (let i = 0; i < 6; i++) {
    const row = document.createElement("tr");

    for (let j = 0; j < 7; j++) {
      const cell = document.createElement("td");
      const cellIndex = i * 7 + j;
      const dayOffset = cellIndex - firstDay;

      if (dayOffset < 0) {
        // ì´ì „ ë‹¬ ë‚ ì§œ
        const day = prevLastDate + dayOffset + 1;
        cell.innerText = day;
        cell.classList.add("dim");
      } else if (dayOffset >= lastDate) {
        // ë‹¤ìŒ ë‹¬ ë‚ ì§œ
        cell.innerText = nextMonthDate++;
        cell.classList.add("dim");
      } else {
        // í˜„ì¬ ë‹¬ ë‚ ì§œ
        const currentDate = dayOffset + 1;
        const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(currentDate).padStart(2, '0')}`;
        cell.innerText = currentDate;

        const event = schedules.find(e => e.date === dateStr);
     if (event) {
  const div = document.createElement("div");
  div.className = "event";
  div.textContent = event.title;
  div.style.backgroundColor = event.color;
  
  if (event.note) {
    div.title = event.note;
  }

  // âœ… ì¼ì • í´ë¦­ ì‹œ ìƒì„¸ë³´ê¸° ëª¨ë‹¬ ì—´ê¸°
  div.onclick = (e) => {
    e.stopPropagation(); // ë¶€ëª¨ tdì˜ í´ë¦­ ë°©ì§€
    openViewModal(event);
  };

  cell.appendChild(div);

}

        cell.onclick = (e) => openModal(year, month, currentDate, e);
      }

      row.appendChild(cell);
    }

    calendarBody.appendChild(row);
  }
}

function openModal(year, month, date, clickEvent = null) {
  const formattedDate = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
  const modal = document.getElementById("schedule-modal");

  document.getElementById("modal-date").value = formattedDate;

  const existing = schedules.find(e => e.date === formattedDate);
  document.getElementById("modal-title").value = existing ? existing.title : "";

  if (clickEvent) {
    const modalWidth = 300;
    const modalHeight = 220;
    const rect = clickEvent.target.getBoundingClientRect();

    let x = rect.left + window.scrollX - 300;
    let y = rect.top + window.scrollY - modalHeight + 100;

    // ì˜¤ë¥¸ìª½ ë„˜ì¹¨ ë°©ì§€
    if (x + modalWidth > window.innerWidth + window.scrollX) {
      x = window.innerWidth + window.scrollX - modalWidth - 10;
    }

    // ìœ„ìª½ ë„˜ì¹¨ ë°©ì§€
    if (y < window.scrollY + 10) {
      y = rect.bottom + window.scrollY + 10;
    }

    modal.style.left = `${x}px`;
    modal.style.top = `${y}px`;
  }

  modal.style.display = "block";

  setTimeout(() => {
    document.getElementById("modal-title").focus();
  }, 100);
}

function closeModal() {
  document.getElementById("schedule-modal").style.display = "none";
}

function saveSchedule() {
  const date = document.getElementById("modal-date").value;
  const title = document.getElementById("modal-title").value;
  if (!title) return alert("ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");

  const existing = schedules.find(e => e.date === date);
  const color = existing ? existing.color : getRandomColor();

  // ê¸°ì¡´ ì¼ì • ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€
  schedules = schedules.filter(e => e.date !== date);
  schedules.push({ date, title, color });

  closeModal();
  renderCalendar(currentYear, currentMonth);
}

function prevMonth() {
  if (currentMonth === 1) {
    currentMonth = 12;
    currentYear--;
  } else {
    currentMonth--;
  }
  renderCalendar(currentYear, currentMonth);
}

function nextMonth() {
  if (currentMonth === 12) {
    currentMonth = 1;
    currentYear++;
  } else {
    currentMonth++;
  }
  renderCalendar(currentYear, currentMonth);
}

function getRandomColor() {
  const colors = ['#f6b3dc', '#a1c4fd', '#ffd59e', '#c3f584', '#c0aaff', '#ffaaa5', '#ffda77'];
  return colors[Math.floor(Math.random() * colors.length)];
}

window.addEventListener("click", function (event) {
  const scheduleModal = document.getElementById("schedule-modal");
  const detailModal = document.getElementById("detail-schedule-modal");

  if (event.target === scheduleModal) {
    closeModal();
  }
  if (event.target === detailModal) {
    closeDetailModal();
  }
});

// ESC í‚¤ ëˆ„ë¥´ë©´ ëª¨ë‹¬ ë‹«ê¸°
document.addEventListener("keydown", function (event) {
  if (event.key === "Escape") {
    closeModal();
  }
});

document.addEventListener("DOMContentLoaded", () => {
  renderCalendar(currentYear, currentMonth);
});

  let flatpickrStart = null;
  let flatpickrEnd = null;

function openDetailModal() {
  closeModal();
  const modal = document.getElementById("detail-schedule-modal");
  modal.style.display = "block";

  if (!flatpickrStart) {
    flatpickrStart = flatpickr("#start-date", { dateFormat: "Y-m-d" });
  }
  if (!flatpickrEnd) {
    flatpickrEnd = flatpickr("#end-date", { dateFormat: "Y-m-d" });
  }
}



// ë“±ë¡ ë²„íŠ¼ í´ë¦­ ì‹œ ì²˜ë¦¬ (ìƒ˜í”Œ ë™ì‘)
function submitDetailSchedule() {
  const title = document.getElementById("detail-title").value;
  const start = document.getElementById("start-date").value;
  const end = document.getElementById("end-date").value;
  const note = document.getElementById("detail-note").value; // âœ… ì¶”ê°€ëœ ë¶€ë¶„

  if (!title || !start || !end) return alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•˜ì„¸ìš”.");

  const color = '#a1c4fd';
  const startDate = new Date(start);
  const endDateObj = new Date(end);

  while (startDate <= endDateObj) {
    const dateStr = startDate.toISOString().split("T")[0];
    schedules = schedules.filter(e => e.date !== dateStr);
    schedules.push({ date: dateStr, title, color, note }); // âœ… note ì¶”ê°€
    startDate.setDate(startDate.getDate() + 1);
  }
   closeDetailModal(); // ëª¨ë‹¬ ë‹«ê¸°
  renderCalendar(currentYear, currentMonth);

}
function closeDetailModal() {
  const modal = document.getElementById("detail-schedule-modal");
  modal.style.display = "none";
}

</script>
<script>
  function openViewModal(schedule) {
    document.getElementById("view-date").textContent = schedule.date;
    document.getElementById("view-title").textContent = schedule.title;
    document.getElementById("view-note").textContent = schedule.note || "(ë©”ëª¨ ì—†ìŒ)";
    document.getElementById("view-schedule-modal").style.display = "block";
  }

  function closeViewModal() {
    document.getElementById("view-schedule-modal").style.display = "none";
  }

  // ESC í‚¤ ëˆ„ë¥´ë©´ ë·° ëª¨ë‹¬ ë‹«ê¸°
  document.addEventListener("keydown", function(event) {
    if (event.key === "Escape") {
      closeViewModal();
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</html>
