<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <link rel="stylesheet" href="/css/main/Calendar/calendar.css" />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <link rel="stylesheet" href="/css/main/dashboard/dashboardMain.css" />

    <script src="/scripts/dashboardMain.js"></script>

    <style>
    #detail-schedule-modal textarea {
      resize: vertical;
      padding: 6px;
      border-radius: 6px;
      font-family: inherit;
    }
   
    #detail-schedule-modal label {
      text-align: left;
      font-size: 14px;
      margin-top: 6px;
    }
 
    .flatpickr-calendar {
     max-width: 16.3% !important;
    }

    .modal-view {
      position: absolute;
      z-index: 1000;
      display: none;
      background: white;
      border-radius: 10px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.3);
      padding: 20px;
      transition: opacity 0.2s ease;
      opacity: 0.7;
      
    }

 
   
    </style>
  </head>
  <body>
    <div class="wrapper">
      <div class="wrapperside">
        <div class="profileArea">
          <img src="/images/user.png" alt="profile" />
        </div>
        <ul>
          <li>
            <a href="#"><img src="/images/Grid.svg" alt="dashboard" /></a>
          </li>
          <li>
            <a href="#"><img src="/images/File text.svg" alt="document" /></a>
          </li>
          <li>
            <a href="#"><img src="/images/Calendar.svg" alt="calendar" /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/Message square.svg" alt="message"
            /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/Clipboard.svg" alt="message-board"
            /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/gmail_groups.svg" alt="director"
            /></a>
          </li>
          <li>
            <a href="#"
              ><img src="/images/Cloud.svg" alt="cloud-computing"
            /></a>
          </li>
          <li>
            <a href="#"><img src="/images/Settings.svg" alt="setting" /></a>
          </li>
        </ul>
      </div>
      <div class="container">
        <header>
          <div class="headerArea">
            <div class="headerlogo">
              <a href="#"><img src="/images/logo.png" alt="J2SMLogo" /></a>
            </div>
            <div class="darkmode">
              <label class="toggle-switch">
                <span class="label-text">DARK MODE</span>
                <input type="checkbox" id="darkModeToggle" />
                <span class="slider"></span>
              </label>
            </div>
            <div class="alert">
              <img src="/images/bell.png" alt="bell" />
            </div>
          </div>
        </header>
        <main>
          <aside>
            <div class="sidemenu">
              <div class="sideTop">
                <h3>Calendar</h3>
              </div>
              <a href="#">내 캘린더</a><br/><br/>
              <a href="#">공유 캘린더</a>
            </div>
          </aside>
          <div class="contentArea">
             <div id="calendar-container">
                <div class="calendar-header">
                  <button onclick="prevMonth()">❮</button>
                  <span id="calendar-title" style="margin: 0 40px;"></span>
                  <button onclick="nextMonth()">❯</button>
                </div>

                <table class="calendar-table">
                  <thead>
                    <tr>
                      <th>Sun</th><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th>
                    </tr>
                  </thead>
                  <tbody id="calendar-body"></tbody>
                </table>

                
              </div>

              <!-- 일정 모달 -->
              <div id="schedule-modal" class="modal">
                <div class="modal-content" onclick="event.stopPropagation()">
                  <span class="close" onclick="closeModal()">&times;</span>
                  <h3>간편 일정 등록</h3>
                  <input type="hidden" id="modal-date" />
                  <input type="text" id="modal-title" placeholder="일정 제목 입력" />
                  <button class="calen" onclick="saveSchedule()">등록하기</button>
                  <button class="calen" onclick="openDetailModal()">세부일정등록</button>
                  <button class="calen" onclick="">알람 ON</button>
                  <button class="calen" onclick="">일정 삭제</button>
                </div>
              </div>
          </div>
        </main>
        <footer></footer>
      </div>
    </div>
  </body>

    <div id="detail-schedule-modal" class="modal detail-modal">
      <div class="modal-content" onclick="event.stopPropagation()">
        <span class="close" onclick="closeDetailModal()">&times;</span>
        <h3>세부일정 등록</h3>

        <label>일정 제목</label>
        <input type="text" id="detail-title" class="form-input" placeholder="일정 제목" />

        <label>시작 날짜</label>
        <input type="date" id="start-date" class="form-input" />

        <label>종료 날짜</label>
        <input type="date" id="end-date" class="form-input" />

        <label>장소</label>
        <input type="text" id="place" class="form-input" placeholder="장소" />

        <label>참석 인원</label>
        <input type="text" id="member" class="form-input" placeholder="참석 인원" />

        <label>세부 일정</label>
        <textarea id="detail-note" rows="3" placeholder="추가 메모..."></textarea>

        <button class="calen" onclick="submitDetailSchedule()">등록</button>
      </div>
    </div>

    <div id="view-schedule-modal" class="modal-view" style="display:none;">
      <div class="modal-content">
        <span class="close" onclick="closeViewModal()">&times;</span>
        <h3 style="text-align: center;">일정 상세 보기</h3>
        <p><strong>날짜:</strong> <span id="view-date"></span></p>
        <p><strong>제목:</strong> <span id="view-title"></span></p>
        <p><strong>장소:</strong> <span id="view-place"></span></p>
        <p><strong>참석자:</strong> <span id="view-member"></span></p>
        <p><strong>메모:</strong> <span id="view-note"></span></p>
      </div>
      <div style="padding: 20px;"><button class="calen" onclick="editSchedule()">수정하기</button></div>
    </div>

<script>
    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth() + 1;
    let schedules = [];

    function renderCalendar(year, month) {
      const calendarBody = document.getElementById("calendar-body");
      const title = document.getElementById("calendar-title");
      title.innerText = `${year}.${String(month).padStart(2, '0')}`;
      calendarBody.innerHTML = "";

      const firstDay = new Date(year, month - 1, 1).getDay();
      const lastDate = new Date(year, month, 0).getDate();
      const prevLastDate = new Date(year, month - 1, 0).getDate();

      let nextMonthDate = 1;

      for (let i = 0; i < 6; i++) {
        const row = document.createElement("tr");

        for (let j = 0; j < 7; j++) {
          const cell = document.createElement("td");
          const cellIndex = i * 7 + j;
          const dayOffset = cellIndex - firstDay;

          if (dayOffset < 0) {
            const day = prevLastDate + dayOffset + 1;
            cell.innerText = day;
            cell.classList.add("dim");
          } else if (dayOffset >= lastDate) {
            cell.innerText = nextMonthDate++;
            cell.classList.add("dim");
          } else {
            const currentDate = dayOffset + 1;
            const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(currentDate).padStart(2, '0')}`;
            cell.innerText = currentDate;

            const eventsOnThisDay = schedules.filter(e => e.start <= dateStr && e.end >= dateStr);

            eventsOnThisDay.forEach(event => {
              const div = document.createElement("div");
              div.className = "event";
              div.textContent = event.title;
              div.style.backgroundColor = event.color;
              if (event.note) div.title = event.note;

              div.onclick = (e) => {
                e.stopPropagation();
                openViewModal(event);
              };

              cell.appendChild(div);
            });

            cell.onclick = (e) => openModal(year, month, currentDate, e);
          }

          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
      }
    }

    function openModal(year, month, date, clickEvent = null) {
      const formattedDate = `${year}-${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
      const modal = document.getElementById("schedule-modal");
      document.getElementById("modal-date").value = formattedDate;
      document.getElementById("modal-title").value = "";

      if (clickEvent) {
        const modalWidth = 300;
        const modalHeight = 220;
        const rect = clickEvent.target.getBoundingClientRect();

        let x = rect.left + window.scrollX - 500;
        let y = rect.top + window.scrollY - modalHeight + 120;

        if (x + modalWidth > window.innerWidth + window.scrollX) {
          x = window.innerWidth + window.scrollX - modalWidth - 10;
        }
        if (y < window.scrollY + 10) {
          y = rect.bottom + window.scrollY + 10;
        }

        modal.style.left = `${x}px`;
        modal.style.top = `${y}px`;
      }

      modal.style.display = "block";
      setTimeout(() => {
        document.getElementById("modal-title").focus();
      }, 100);
    }

    function closeModal() {
      document.getElementById("schedule-modal").style.display = "none";
    }

    function saveSchedule() {
      const date = document.getElementById("modal-date").value;
      const title = document.getElementById("modal-title").value;
      if (!title) return alert("일정 제목을 입력하세요.");

      const color = getRandomColor();

      schedules.push({
        start: date,
        end: date,
        title,
        color
      });

      closeModal();
      renderCalendar(currentYear, currentMonth);
    }

    function prevMonth() {
      if (currentMonth === 1) {
        currentMonth = 12;
        currentYear--;
      } else {
        currentMonth--;
      }
      renderCalendar(currentYear, currentMonth);
    }

    function nextMonth() {
      if (currentMonth === 12) {
        currentMonth = 1;
        currentYear++;
      } else {
        currentMonth++;
      }
      renderCalendar(currentYear, currentMonth);
    }

    function getRandomColor() {
      const colors = ['#f6b3dc', '#a1c4fd', '#ffd59e', '#c3f584', '#c0aaff', '#ffaaa5', '#ffda77'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    window.addEventListener("click", function (event) {
      const scheduleModal = document.getElementById("schedule-modal");
      const detailModal = document.getElementById("detail-schedule-modal");
      if (event.target === scheduleModal) closeModal();
      if (event.target === detailModal) closeDetailModal();
    });

    document.addEventListener("keydown", function (event) {
      if (event.key === "Escape") {
        closeModal();
        closeViewModal();
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      renderCalendar(currentYear, currentMonth);
    });

    function openDetailModal() {
      closeModal();
      const modal = document.getElementById("detail-schedule-modal");
      document.getElementById("detail-title").value = "";
      document.getElementById("start-date").value = "";
      document.getElementById("end-date").value = "";
      document.getElementById("place").value = "";
      document.getElementById("member").value = "";
      document.getElementById("detail-note").value = "";
      modal.style.display = "block";

      flatpickr("#start-date", { dateFormat: "Y-m-d" });
      flatpickr("#end-date", { dateFormat: "Y-m-d" });
    }

    function submitDetailSchedule() {
      const title = document.getElementById("detail-title").value;
      const start = document.getElementById("start-date").value;
      const end = document.getElementById("end-date").value;
      const place = document.getElementById("place").value;
      const member = document.getElementById("member").value;
      const note = document.getElementById("detail-note").value;

      if (!title || !start || !end) return alert("모든 항목을 입력하세요.");

      const color = getRandomColor();

      schedules.push({ title, start, end, color, note, place, member });
      closeDetailModal();
      renderCalendar(currentYear, currentMonth);
    }

    function closeDetailModal() {
      const modal = document.getElementById("detail-schedule-modal");
      modal.style.display = "none";
    }

    function openViewModal(schedule) {
      document.getElementById("view-date").textContent = `${schedule.start} ~ ${schedule.end}`;
      document.getElementById("view-title").textContent = schedule.title;
      document.getElementById("view-place").textContent = schedule.place || "-";
      document.getElementById("view-member").textContent = schedule.member || "-";
      document.getElementById("view-note").textContent = schedule.note || "(메모 없음)";
      document.getElementById("view-schedule-modal").style.display = "block";
    }

    function closeViewModal() {
      document.getElementById("view-schedule-modal").style.display = "none";
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</html>
